<?xml version="1.0" encoding="utf-8"?>
<odoo>
	<report
		id="report_statement"
        model="res.partner"
        string="Estado de Cuenta"
        report_type="qweb-pdf"
        name="wolftrakglobal.template_report_statement"
        file="wolftrakglobal.wolftrak_report_statement"
    />

	<template id="template_report_statement">
		<t t-call="report.external_layout">
            <t t-foreach="docs" t-as="o">
                <div class="page" background="white">
                    <table class="table table-condensed table-bordered">
                        <tr>
                            <td>Cliente</td> <td><b><span t-field="o.name"/></b></td>
                            <td>RNC</td> <td><b><span t-field="o.doc_ident"/></b></td>
                            <td>Tlf.</td> <td><b><span t-field="o.child_ids.phone"/></b></td>
                        </tr>
                        <tr>
                            <td>Régimen de Pago</td> <td><b><span t-field="o.pay_reg"/></b></td>
                            <td>Estado DGII</td> <td><b><span t-field="o.dgii_state"/></b></td>
                            <td>Email</td> <td><b><span t-field="o.child_ids.email"/></b></td>
                        </tr>
                    </table>

                    <table class="table table-condensed table-bordered">
                        <tr>
                            <td><b>Número de Factura</b></td>
                            <td><b>Fecha de Emisión</b></td>
                            <td><b>Fecha de Vencimiento</b></td>
                            <td><b>Tasa de Cambio</b></td>
                            <td><b>Monto</b></td>
                            <td><b>Abono</b></td>
                            <td><b>Fecha del abono</b></td>
                            <td><b>Saldo pendiente</b></td>
                        </tr>
                        <t t-foreach="o.partner_inv" t-as="inv">
                            <tr>
                                <t t-if="inv.state == 'draft'">
                                    <td><span t-field="inv.draft_number"/></td>
                                    <td><span t-field="inv.date_invoice"/></td>
                                </t>
                                <t t-if="inv.state != 'draft'">
                                    <td><span t-field="inv.number"/></td>
                                    <td><span t-field="inv.date"/></td>
                                </t>
                                <td><span t-field="inv.date_due"/></td>
                                <td>$<span t-field="inv.ex_rate"/></td>
                                <td><span t-field="inv.amount_total"/></td>
                                <td><t t-foreach="inv.payment_move_line_ids" t-as="pm"><span t-field="pm.credit"/><br/></t></td>
                                <t t-if="inv.payment_move_line_ids">
                                    <td>
                                        <t t-foreach="inv.payment_move_line_ids" t-as="pm"><span t-field="pm.date"/><br/></t>
                                    </td>
                                </t>
                                <t t-else=""><td></td></t>
                                <td t-if="inv.state == 'draft'"><span t-field="inv.amount_total"/></td>
                                <td t-if="inv.state != 'draft"><span t-field="inv.residual"/></td>
                            </tr>
                        </t>
                    </table>
                    <div align="center">
                        <table class="table table-bordered table-condensed">
                            <tr>
                                <td>Saldo a Favor</td>
                                <td>Total</td>
                            </tr>

                            <tr>
                                <t t-set="favor" t-value="0"/>
                                <t t-foreach="o.partner_inv" t-as="inv">
                                    <t t-set="a_total" t-value="inv.amount_total"/>
                                    <t t-set="residual" t-value="inv.residual"/>

                                    <t t-set="balance" t-value="a_total+(residual * -1)"/>
                                    <t t-set="favor" t-value="favor + residual"/>
                                </t>
                                <t t-if="favor > 0">
                                    <td></td>
                                    <td><t t-esc="favor" t-options='{"widget": "monetary", "display_currency": o.currency_id}'/></td>
                                </t>
                                <t t-elif="favor &lt; 0">
                                    <td><span t-esc="favor" t-options='{"widget": "monetary", "display_currency": o.currency_id}'/></td>
                                    <td></td>
                                </t>
                            </tr>
                        </table>
                    </div>
                </div>
            </t>
		</t>
	</template>

</odoo>